<div class="container">
    <div class="form-section">
        <h2 class="form-title">Item Information</h2>
        <form [formGroup]="itemsReg" (ngSubmit)="onSubmit()" enctype="multipart/form-data">
            <div class="form-grid">
                <mat-form-field appearance="fill">
                    <mat-label>Item Name</mat-label>
                    <input matInput formControlName="itemName" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('itemName').touched || submitted) && itemsReg.get('itemName').errors && itemsReg.get('itemName').errors['required']">Item
                        Name
                        is required
                    </span>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Generic Name</mat-label>
                    <input matInput formControlName="genericName" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('genericName').touched || submitted) && itemsReg.get('genericName').errors && itemsReg.get('genericName').errors['required']">Generic
                        Name
                        is required
                    </span>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Formulation</mat-label>
                    <input matInput formControlName="formulation" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('formulation').touched || submitted) && itemsReg.get('formulation').errors && itemsReg.get('formulation').errors['required']">Formulation
                        is required
                    </span>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Type</mat-label>
                    <input matInput formControlName="type" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('type').touched || submitted) && itemsReg.get('type').errors && itemsReg.get('type').errors['required']">Type
                        is required
                    </span>
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Consume Type</mat-label>
                    <input matInput formControlName="consumeType" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('consumeType').touched || submitted) && itemsReg.get('consumeType').errors && itemsReg.get('consumeType').errors['required']">Consume
                        Type
                        is required
                    </span>

                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Description</mat-label>
                    <input matInput formControlName="description" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('description').touched || submitted) && itemsReg.get('description').errors && itemsReg.get('description').errors['required']">Description
                        is required
                    </span>
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Pack Size</mat-label>
                    <input matInput formControlName="packSize" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('packSize').touched || submitted) && itemsReg.get('packSize').errors && itemsReg.get('packSize').errors['required']">Pack
                        Size
                        is required
                    </span>
                </mat-form-field>

                <!-- <mat-form-field appearance="fill">
                    <mat-label>Unit Of Measure</mat-label>
                    <input matInput formControlName="unitOfMeasure" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('unitOfMeasure').touched || submitted) && itemsReg.get('unitOfMeasure').errors && itemsReg.get('unitOfMeasure').errors['required']">Unit Of Measure
                        is required
                    </span>
                </mat-form-field> -->

                <mat-form-field appearance="fill">
                    <mat-label>Unit Of Measure</mat-label>
                    <mat-select formControlName="unitOfMeasure" (selectionChange)="onUnitChange($event.value)">
                        <mat-option *ngFor="let unit of unitOptions" [value]="unit">{{ unit }}</mat-option>
                        <mat-option value="Other">Other (Custom)</mat-option>
                    </mat-select>
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('unitOfMeasure').touched || submitted) && itemsReg.get('unitOfMeasure').errors && itemsReg.get('unitOfMeasure').errors['required']">
                        Unit Of Measure is required
                    </span>
                </mat-form-field>

                <!-- Show custom input if "Other" is selected -->
                <mat-form-field appearance="fill" *ngIf="showCustomUnit">
                    <mat-label>Custom Unit</mat-label>
                    <input matInput [(ngModel)]="customUnit" (ngModelChange)="setCustomUnit()"
                        [disabled]="itemsReg.disabled" />
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Batch Number</mat-label>
                    <input matInput formControlName="batchNumber" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('batchNumber').touched || submitted) && itemsReg.get('batchNumber').errors && itemsReg.get('batchNumber').errors['required']">Batch
                        Number
                        is required
                    </span>
                </mat-form-field>



                <mat-form-field class="full-width" appearance="fill">
                    <mat-label>Expiry Date MM/DD/YYYY</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="expiryDate">


                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>

                    <mat-datepicker #picker></mat-datepicker>
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('expiryDate').touched || submitted) && itemsReg.get('expiryDate').errors && itemsReg.get('expiryDate').errors['required']">Expiry
                        Date
                        is required
                    </span>
                </mat-form-field>



                <mat-form-field appearance="fill">
                    <mat-label>Prescription Required</mat-label>
                    <mat-select formControlName="prescriptionRequired">
                        <mat-option value="YES">Yes</mat-option>
                        <mat-option value="NO">No</mat-option>
                    </mat-select>
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('prescriptionRequired').touched || submitted) && itemsReg.get('prescriptionRequired').errors && itemsReg.get('prescriptionRequired').errors['required']">Prescription
                        Required
                        is required
                    </span>
                </mat-form-field>

                <mat-form-field appearance="fill">
                    <mat-label>Reorder Level</mat-label>
                    <input matInput formControlName="reorderLevel" />
                    <span class="text-danger"
                        *ngIf="(itemsReg.get('reorderLevel').touched || submitted) && itemsReg.get('reorderLevel').errors && itemsReg.get('reorderLevel').errors['required']">Reorder
                        Level
                        is required
                    </span>
                </mat-form-field>

                <!-- Replace your file input section with this for better style -->
                <!-- <div class="file-upload">
                    <label for="itemImage">Image</label>
                    <input id="itemImage" type="file" (change)="onFileSelected($event)" />
                </div> -->

                <div class="file-upload">
                    <label for="fileInput">Image:</label>
                    <input id="fileInput" type="file" (change)="onFileSelected($event)" required #fileInput>

                </div>
            </div>

            <!-- <button mat-raised-button color="primary" type="submit">Save</button> -->
            <div class="button-group">
                <button mat-raised-button color="primary" type="submit"
                    [disabled]="isbtnDisabled">{{saveButtonLabeel}}</button>
                <button type="reset" mat-raised-button color="warn" class="form-btn" (click)="resetData()">Reset
                </button>
            </div>
        </form>
    </div>

    <!-- <div class="table-section">
        <div class="refresh-filter-section">
            <div class="refresh-button">
                <button mat-icon-button color="primary" (click)="refreshData()">
                    <mat-icon>refresh</mat-icon>
                </button>
            </div>
            <mat-form-field class="filter">
                <input matInput (keyup)="applyFilter($event)" placeholder="Filter">
            </mat-form-field>
        </div>
        <mat-table [dataSource]="dataSource">
            <ng-container matColumnDef="itemName">
                <mat-header-cell *matHeaderCellDef> Item Name </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.itemName }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="genericName">
                <mat-header-cell *matHeaderCellDef> Generic Name </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.genericName }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="formulation">
                <mat-header-cell *matHeaderCellDef> Formulation </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.formulation }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="type">
                <mat-header-cell *matHeaderCellDef> Type </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.type }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="consumeType">
                <mat-header-cell *matHeaderCellDef> Consume Type </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.consumeType }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="description">
                <mat-header-cell *matHeaderCellDef> Description </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.description }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="packSize">
                <mat-header-cell *matHeaderCellDef> Pack Size </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.packSize }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="unitOfMeasure">
                <mat-header-cell *matHeaderCellDef> Unit of Measure </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.unitOfMeasure }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="batchNumber">
                <mat-header-cell *matHeaderCellDef> Batch Number </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.batchNumber }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="expiryDate">
                <mat-header-cell *matHeaderCellDef> Expiry Date </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.expiryDate | date }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="prescriptionRequired">
                <mat-header-cell *matHeaderCellDef> Prescription Required </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.prescriptionRequired }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="reorderLevel">
                <mat-header-cell *matHeaderCellDef> Reorder Level </mat-header-cell>
                <mat-cell *matCellDef="let item"> {{ item.reorderLevel }} </mat-cell>
            </ng-container>

            <ng-container matColumnDef="image">
                <mat-header-cell *matHeaderCellDef> Image </mat-header-cell>
                <mat-cell *matCellDef="let item">
                    <img *ngIf="item.imageBase64" [src]="item.imageBase64" alt="Item Image" width="80"
                        class="item-image" />
                </mat-cell>
            </ng-container>


            <ng-container matColumnDef="actions">
                <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
                <mat-cell *matCellDef="let element">
                    <button mat-icon-button color="warn" (click)="editData(element)" matTooltip="edit">
                        <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteData(element)" matTooltip="delete">
                        <mat-icon>delete</mat-icon>
                    </button>
                </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>
        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

    </div> -->

    <div class="filter-section">
        <div class="filter-controls">
            <!-- <div class="refresh-btn">
      <button mat-icon-button color="primary" (click)="refreshData()" matTooltip="Refresh">
        <mat-icon>refresh</mat-icon>
      </button>
    </div> -->
            <mat-form-field appearance="outline" class="search-field">
                <input matInput (keyup)="applyFilter($event)" placeholder="Search by name, type...">
                <mat-icon matPrefix>search</mat-icon>
            </mat-form-field>
        </div>
    </div>

    <div class="item-container">
        <mat-card class="item-card" *ngFor="let item of pagedItems">
            <div class="card-image-container">
                <img *ngIf="item.imageBase64" [src]="item.imageBase64" alt="Item Image" class="card-item-image" />
                <div class="image-overlay">
                    <button mat-mini-fab color="primary" (click)="openDetailsDialog(item)">
                        <mat-icon>visibility</mat-icon>
                    </button>
                </div>
            </div>

            <mat-card-header>
                <mat-card-title>{{ item.itemName }}</mat-card-title>
                <mat-card-subtitle>{{ item.genericName }}</mat-card-subtitle>
            </mat-card-header>

            <mat-card-actions>
                <button mat-raised-button class="card-btn" color="primary" (click)="editData(item)">
                    edit
                </button>
                <button mat-raised-button class="card-btn" color="warn" (click)="deleteData(item)">
                    delete
                </button>
                <span class="spacer"></span>
                <button mat-button color="primary" (click)="openDetailsDialog(item)">
                    Details
                </button>
            </mat-card-actions>
        </mat-card>
    </div>
    <mat-paginator [length]="filteredItems.length" [pageSize]="pageSize" [pageSizeOptions]="[4, 8, 12]"
        (page)="onPageChange($event)">
    </mat-paginator>


</div>